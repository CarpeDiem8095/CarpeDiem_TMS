<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cp.tms.model.chat">
<!-- 로그인 테스트  -->
<select id="logintest" parameterType="java.lang.String" resultType="com.cp.tms.dto.UserDto">
SELECT * FROM MEMBERBOARD
WHERE USERID=#{userid}
</select>


<!--채팅 -->
<!-- 채팅방 생성 -->
<insert id="chatboardinsert" parameterType="chatDto">
INSERT INTO CHATINGBOARD
(SEQ, CHATMYID, CHATYOURID,
 CHATGROUPID, CHATCONTENT, CHATREGDATE,CHATDELFLAG)
VALUES(CHATINGBOARD_SEQ.NEXTVAL, #{chatmyid},#{chatyourid},
#{chatgroupid},'',SYSDATE,'N')
</insert>

<!-- 생성내역이 있다면 대화내역 가져오기
	최근 시간 업데이트
 -->
<update id="chatboardupdate" parameterType="java.lang.String">
UPDATE CHATINGBOARD SET CHATREGDATE =SYSDATE 
WHERE CHATMYID =#{chatmyid}
</update>

<select id="selchatboardcontent" parameterType="java.lang.String" resultType="ChatDto">
SELECT CHATCONTENT FROM CHATINGBOARD c 
WHERE CHATMYID =#{chatmyid}
</select>

<!-- 채팅방 삭제 -->
<delete id="ChatDto" parameterType="chatDto">
DELETE FROM CHATINGBOARD c
WHERE CHATMYID =#{chatmyid}
AND SEQ IN
        <foreach item="seq" collection="seqs" open="(" separator="," close=")">
            #{seq}
        </foreach>
</delete>

<!--  내 채팅방 목록 죄회 -->
<select id="selmychatboard" parameterType="java.lang.String" resultType="chatDto">
SELECT CHATGROUPID,CHATMYID FROM
(SELECT CHATGROUPID,CHATMYID ,ROW_NUMBER () OVER(ORDER BY CHATREGDATE DESC) RN
FROM CHATINGBOARD c
WHERE CHATDELFLAG ='N'
AND CHATMYID =#{chatmyid})
WHERE RN BETWEEN 1 AND 10;
</select>
</mapper>
